- configuration is declarative using `yaml configuration file`

  - user define the desired running state,
  - k8s constantly try to meet the desired state
  - a state is defined by the etcd data

## Fields

- kind: apiVersion

  - Pod: v1
  - Service: v1
  - ReplicaSet: apps/v1
  - Deployment: apps/v1

- `metadata`: metadata regarding the configuration

  - name
  - labels: labels is a dictionary containing `arbitrary fields`!!
    - labels are used to `filter deployed pod`, eg front-end, backend

- `spec(specification)`: determined by the `kind`

- `selector`:

- status: k8s automatically adds the current state as this field, through etcd,

### Resource Type: Pods, Services, ReplicaSets, Deployments

- Pod

## Examples

### deploy a pod

```yaml
apiVersion: v1
kind: Pod
metadata:
  name:
  labels:
    app: nginx
    type: backend
spec:
  containers: # an array of containers
    - name: nginx
      image: nginx:latest
      ports:
        - containerPort: 80 # which port a container open
    - name: nginx-helper
      image: my-nginx-helper
      ports:
        - containerPort: 81
```

### deploy a Deployment

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: my-app
  labels:
    app: my-app
    type: front-end
spec:
  replicas: 3
  selector: # select the target
    matchLabels: # matched labels will be affected by this config
      app: my-app
  template: # pod's template (a nested POD config without `apiVersion` and `kind`)
    metadata:
      labels:
        app: my-app
    spec:
      containers:
        - name: my-app
          image: my-image
          env:
            - name: SOME_ENV
              value: $SOME_ENV
          ports:
            - containerPort: 8080
```

### deploy a ReplicaSet

- ReplicaSets affect pods through both: `selector` and `template`
  - `selector` is used to filter through existing resources that applies
  - `template` is used to spawn new resource when a replicaSet needs to

```yaml
apiVersion: apps/v1
kind: ReplicaSet
metadata:
  name: my-replicaset
  labels:
    app: my-app
spec:
  replicas: 3
  selector: # ReplicaSet have one more selector field over ReplicationController
    matchLabels:
      app: my-app
  template:
    metadata:
      labels:
        app: my-app
    spec:
      containers:
        - name: my-container
          image: nginx:latest
          ports:
            - containerPort: 80
```

- deploy a ReplicationController

```yaml
apiVersion: v1
kind: ReplicationController
metadata:
  name: myapp-rc
  labels:
    app: my-app
    type: front-end
spec:
  replicas: 3
  template:
    metadata:
      labels:
        app: my-app
    spec:
      containers:
        - name: my-container
          image: nginx:latest
          ports:
            - containerPort: 80
```

### deploy a Service

```yaml
apiVersion: v1
kind: Service
metadata:
  name: my-service
spec:
  selector:
    app: my-app
  ports:
    - protocol: TCP
      port: 80
      targetPort: 8080
```
